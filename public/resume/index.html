<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
<title>resume.md</title>

<noscript>The custom Markdown parser on this page requires JavaScript to be enabled.</noscript>

<div class="content"><div class="download-pdf"><a href="resume.pdf" class="pdf">Download PDF</a></div></div>
<div class="toggle-source">
  &lt;<a href="#view-source" id="view-source">#view source</a><a href="#view-styled" id="view-styled">#view-styled</a>&gt;
</div>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Fira+Sans:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">


<link rel="stylesheet" href="../common.css" />
<style>
:root {
  color-scheme: only light;
  --foreground: var(--theme-light-foreground);
  --background: var(--theme-light-background);
}

@counter-style double-chevron {
  system: cyclic;
  symbols: '»';
  suffix: ' ';
}

html, body, dl, dt, dd, ul, li {
  margin: 0;
  padding: 0;
}

body {
  font-size: 16px;
  padding-bottom: 2em;
}

.toggle-source {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  line-height: 2em;
  text-align: center;
  background: inherit;
  font-family: 'Fira Code', monospace;

  /* &::before {
    content: ' NORMAL   master  ~2  public/resume/resume.md                                                 utf-8     markdown  10%   18:31 ';
    display: block;
  } */

  a {
    color: var(--b24-blue) !important;
    text-decoration: none;

    :has(:target) &:target,
    :not(:has(:target)) &:not(:first-of-type) {
      display: none;
    }
  }
}

/* dt {
  font-size: inherit !important;
} */

.content {
  position: relative;
}

/* styles for styled mode */
body:not(:has(#view-source:target)) {
  background: var(--background);
  color: var(--foreground);
  line-height: 1.4em;
  text-align: justify;
  hyphens: auto;
  font-family: 'Fira Sans', sans-serif;

  a {
    color: var(--b24-bright-red);
    text-decoration: none;
  }

  .download-pdf {
    scale: 1.5;
    transform-origin: top right;
    position: fixed;
    top: 0;
    right: max(2em, calc(50% - 400px));
    width: 40px;
    font-family: 'Fira Code', monospace;

    .pdf {
      background: #f0f0ff;
      width: 40px;
      height: 25px;
      border-radius: 3px;
      box-shadow: 0 2px 1px -1px rgba(0, 0, 0, 0.15);
      position: fixed;
      display: block;
      top: 0;
      font-size: 0;
      line-height: 1em;
      color: var(--b24-light-gray);
      overflow: hidden;

      &::before {
        content: '↓';
        display: block;
        position: absolute;
        bottom: -28px;
        line-height: 1em;
        left: 50%;
        font-size: 160px;
        width: 160px;
        margin-left: -80px;
        text-align: center;
        color: #e3e3e3;
      }

      &::after {
        content: 'pdf';
        font-size: 12px;
        position: absolute;
        bottom: 10px;
        width: 100%;
        text-align: center;
      }
    }
  }

  .content {
    position: relative;
    max-width: 800px;
    margin: auto;
    overflow: hidden;
    padding: 2em 1em 2em;
  }

  .toggle-source {
    padding-top: 0;
    box-shadow: 0 0 2em 1em var(--background);
  }

  .line,
  .comment,
  .link-href,
  .link-ref,
  .link-ref-name,
  .link-ref-url,
  .header-hash,
  .header-line,
  .list,
  .image .src,
  .image .alt,
  .template-source,
  .token {
    display: none;
  }

  img:nth-of-type(1) {
    height: 2.5em;
    vertical-align: top;
    margin-right: 0.2em;
    display: none;
  }

  /* headers */
  h1 {
    font-size: 4em;
    line-height: 2.5em;
  }

  h2, h3 {
    margin-top: 1.7em;
  }

  /* lists */
  dl {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 0 .5ch;

    &:nth-of-type(1) {
      grid-template-columns: repeat(4, max-content);
      justify-content: center;

      dd:nth-of-type(2n-1) {
        padding-right: 8ch;
      }
    }
  }

  dt {
    justify-self: end;

    &::after {
      content: ':';
    }
  }

  dt, dd {
    display: inline;
  }

  ul {
    margin-left: 1em;
    list-style: double-chevron;
  }

  dl .template-result {
    vertical-align: super;
    font-size: xx-small;
    font-style: italic;
    display: inline-block;
    margin-top: -5px;
  }

  dl .template-result::after {
    content: '+';
  }

  /* Make things a bit responsive. */
  @media screen and (max-width: 699px) {
    h1 {
      font-size: 3em;
    }

    dl:nth-of-type(1) dd:nth-of-type(2n-1) {
      padding-right: 0;
    }
  }

  @media screen and (max-width: 549px) {
    h1 {
      text-align: center;

      .image {
        display: block;
      }

      img {
        height: 270px !important;
      }
    }

    dl:nth-of-type(1) {
      grid-template-columns: repeat(2, max-content);
      column-gap: 1ch;
    }
  }
}

/* styles for source mode */
body:has(#view-source:target) {
  color: var(--term-foreground);
  background: var(--term-background-image);
  font-family: 'Fira Code', monospace;

  .download-pdf {
    position: absolute;
    visibility: hidden;
    user-select: none;
  }

  .toggle-source {
    padding-top: 0;
    box-shadow: 0 0 1.25em 1em #111;
    user-select: none;
  }

  .toggle-source::after {
    width: 100%;
  }

  .content {
    white-space: pre;
    padding: .5em .5em 3em;
    min-height: 100vh;
    /* overflow: hidden; */

    background-origin: content-box;
    background-position-x: 79ch;
    background-repeat: repeat-y;
    background-image: linear-gradient(
      90deg,
      #2e3436 1ch,
      transparent 1ch,
      transparent 20ch,
      #2e3436 20ch,
      #2e3436 21ch,
      transparent 21ch,
      transparent 40ch,
      #2e3436 40ch,
      #2e3436 41ch,
      transparent 41ch
    );
  }

  /* inline some block elements */
  p, ul, li, dl, dt, dd {
    display: inline;
    margin: 0;
    padding: 0;
  }

  ul, li {
    list-style: none;
  }

  .token {
    display: inline;
  }

  .template-result {
    /* display: none; */
    visibility: hidden;
    position: absolute;
    user-select: none;
  }

  /* images */
  .image {
    img { display: none; }
    .token { color: var(--b24-bright-cyan); }
  }

  /* links */
  a {
    color: var(--b24-bright-magenta);
    text-decoration: none;

    .token { color: var(--b24-bright-cyan) !important; }
    &.link { color: var(--b24-bright-blue); }
    &.link-ref,
    &.link-ref-name { color: var(--b24-bright-green); }
  }

  .template-source { color: var(--b24-bright-cyan); }
  .template-source .action { color: var(--b24-bright-green); }
  .template-source .argument { color: var(--b24-magenta); }

  /* headers */
  h1, h2, h3 {
    color: var(--b24-magenta);
    font-size: inherit;
    font-weight: inherit;
    display: inline;
  }

  .header-line { color: var(--b24-bright-blue); }
  .header-hash { color: var(--b24-red); }

  /* lists */
  dt {
    color: var(--b24-bright-green);
    .token { color: var(--b24-bright-cyan); }
  }

  li .token {
    color: var(--b24-bright-yellow);
  }

  /* Comments */
  .comment { color: var(--b24-bright-cyan); }

  /* Line numbers */
  .line {
    color: var(--b24-bright-yellow);
    display: inline-block;
    user-select: none;
  }
}

/* Hide source toggle when printing, move things around a little */
@media print {
  :root {
    color-scheme: only light;
    --foreground: var(--theme-light-foreground);
    --background: var(--theme-light-background);
  }

  body {
    font-size: 16px;
  }

  .toggle-source,
  .download-pdf {
    display: none !important;
  }

  .content {
    width: 800px;
  }

  .comment {
    display: inline-block;
    color: #fefefe;
    margin: 0;

    .content > .comment {
      display: block;

      &:not(h2 ~ .comment) {
        width: 90%;
        margin: 0 auto;
        padding: 0;
      }
    }
  }

  h1 {
    width: 90%;
    margin-top: 0;
    margin-left: auto;
    margin-right: auto;
  }

  h2:not(#skills) {
    page-break-before: always;
  }

  h2#skills {
    margin-top: 4em !important;
  }

  h3 {
    margin-top: 1em !important;
    margin-bottom: .5em;
  }

  ul, p {
    margin-top: 0 !important;
    margin-bottom: 1em;
  }

  p:nth-of-type(1),
  p:nth-of-type(2) {
    font-size: 1.2em;
    line-height: 1.5em;
    width: 90%;
    margin: 0 auto 1em;
  }

  p:nth-of-type(2) {
    margin: 0 auto 30px;
  }

  dl:nth-of-type(1) {
    font-size: 1.08em;
    line-height: 1.5em;
    margin-bottom: 2em !important;
  }

  dl:nth-of-type(1) dd:nth-of-type(2n-1) {
    padding-right: 4em;
  }
}
</style>

<script type="module">
// A slightly Markdown parser
const response = await fetch('resume.md');
const responseText = await response.text();

const lines = responseText.match(/\n/g).length;
const maxDigits = lines.toString().length;
const content = document.querySelector('.content');
const links = {};

function token([ token ]) {
  return `<span class="token">${token}</span>`;
}

document.addEventListener('copy', (event) => {
  if (document.querySelector('body:not(:has(#view-source:target))')) return;

  const contentRange = document.createRange();
  const selection = document.getSelection();
  let text = '';

  contentRange.selectNode(content);

  for (let i=0; i<selection.rangeCount; i++) {
    const range = selection.getRangeAt(i);
    if (range.intersectsNode(content)) {
      text += range;
    }
  }

  console.log(text);

  event.clipboardData.setData('text/plain', text);
  event.preventDefault();
});

let line = 0;

// Markdown-ish parser -- includes some extra things, slightly clobbers a few things, lacks other things, has some legacy things
content.innerHTML += responseText
  // Images
  .replace(/!\[([^\]]+)\]\(([^\)]+)\)/g, `<span class="image"><span class="alt">${token`![`}$1${token`]`}</span><span class="src">${token`(`}$2${token`)`}</span><img src="$2" alt="$1"></span>`)

  // Links
  .replace(/<(?!\/)([^>\s]+)>/g, (_, link) =>
  `<a href="${/^[^:]+@.+$/.test(link) ? `mailto:${link}` : link}" class="quicklink">${token`&lt;`}${link}${token`&gt;`}</a>`
  )

  .replace(/\[([^\]]+)\]\(([^\)]+)\)/g, `<a href="$2" class="link">${token`[`}$1${token`]`}</a><a href="$2" class="link-href">${token`(`}$2${token`)`}</a>`)

  .replace(/\[([^\]]+)\]:(.+)/g, (_, name, url) => {
    const trimmed = url.replace(/^\s+|\s+$/g, '');

    links[name.replace(/\s+/g, ' ')] = trimmed;

    return `<a class="link-ref" href="${trimmed}">${token`[`}${name}${token`]:`}</a>` +
           `<a class="link-ref-url" href="${trimmed}">${url}</a>`;
  })

  .replace(/\[([^\]]+)\]\[([^\]]*)\]/g, (_, title, name) => {
    const url = links[(name.length ? name : title).replace(/\s+/g, ' ')] || '#';

    return `<a class="link" href="${url}" ${name ? `title="${name}"` : ''}>${token`[`}${title}${token`]`}</a>` +
           `<a class="link-ref-name" href="${url}">${token`[`}${name}${token`]`}</a>`;
  })

  // Headers
  .replace(/^(?<text>.+)\n(?<line>[=-]+)$/mg, (_, text, line, ...args) => {
    const level = line[0] === '=' ? 1 : 2;
    const id = text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    return `<h${level} id="${id}">${text}</h${level}>\n<span class="header-line">${line}</span>`;
  })
  .replace(/^(#+)(.+)$/mg, (_, hashes, text) => {
    let level = hashes.length;
    return `<span class="header-hash">${hashes}</span><h${level}>${text}</h${level}>`;
  })

  // Lists...don't ask.  It's lazy
  .replace(/^(\s*)(?!-->)(?:[-*])((?:[^|\n]|\n )+)/mg, `$1<li>${token`-`}$2</li>`)
  .replace(/((?:<li>(?:.|\n)+?<\/li>\n?)+)/g, '<ul>$1</ul>')

  // Definition lists.  I'm probably using this wrong, but it works
  .replace(/^(.+?)(\s*)\|((?:[^|\n]|\n )+)$/mg, `<dt>$1${token` |`}</dt><dd>$3</dd>`)
  .replace(/((?:<dt>(?:.|\n)+?<\/dt><dd>(?:.|\n)+?<\/dd>\n?)+)/g, '<dl>$1</dl>')

  // HTML comments
  .replace(/<(!--(.|[\r\n])*?--)>/g, '<span class="comment">&lt;$1&gt;</span>')

  // Paragraphs
  .replace(/^(\s?\w(?:.|\n *[^\r\n])+)/mg, '<p>$1</p>')

  // ...Templating.  Not part of Markdown, just conveniently placed here
  .replace(/\{since:([^}]+)\}/g, (_, year) => {
    let result = (new Date().getFullYear()) - parseInt(year, 10);

    if (isNaN(result)) {
      result = year;
    }

    return '<span class="template">' +
        '<span class="template-source">{' +
          '<span class="action">since</span>:' +
          '<span class="argument">' + year + '</span>' +
        '}</span>' +
        '<span class="template-result">' +
          result +
        '</span>' +
      '</span>';
  })

  // Line numbers...it's better not to ask how much of a mess this makes
  .replace(/^/mg, () =>
    `<span class="line">${(++line).toString().padStart(maxDigits, ' ')} </span>`
  );
</script>
